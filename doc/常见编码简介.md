## 1. 常见编码简介

### ASCII
- 7位编码，表示128个字符（基础英文和控制符）。
- 兼容性好，但无法表示非英语字符（如中文）。

### ISO-8859-1（Latin-1）
- 单字节编码，支持西欧语言和符号（共256字符）。
- 不能表示中文、日文等东亚字符。

### GB2312、GBK、GB18030
- **GB2312**：中国大陆早期的汉字编码，支持约7000汉字。
- **GBK**：GB2312的扩展，支持更多汉字及符号（兼容GB2312）。
- **GB18030**：国家标准，支持所有中文字符和Unicode扩展，向下兼容GBK。

### BIG5
- 繁体中文常用编码，主要用于台湾和香港。

### Unicode
- 全球统一字符集标准，编码每个字符一个唯一编号。

#### UTF-8
- 变长编码（1~4字节）。
- 英文等兼容ASCII，中文通常3字节。
- 互联网标准，跨平台最推荐。

#### UTF-16
- 变长编码（2或4字节）。
- Windows和Java内部常用。
- 小端（LE）与大端（BE）区别。

#### UTF-32
- 定长编码（4字节），空间大但处理简单。

---

## 2. 编码转换的基本原理

- **编码转换**本质是：将一串特定编码下的字节序列，解释为字符后，再按目标编码重新编码为新的字节序列。
- 需明确**源编码**和**目标编码**，如“GBK 转 UTF-8”。

---

## 3. C++ 使用 iconv 进行编码转换

### 安装（Linux）

```bash
sudo apt-get install libiconv-hook-dev      # 或 libiconv-dev，视系统而定
```

### 基本用法

```cpp
#include <iconv.h>
#include <cstring>
#include <iostream>

bool code_convert(const char* from_charset, const char* to_charset,
                  const char* inbuf, size_t inlen,
                  char* outbuf, size_t outlen) {
    iconv_t cd = iconv_open(to_charset, from_charset);
    if (cd == (iconv_t)-1) {
        perror("iconv_open");
        return false;
    }
    char **pin = (char**)&inbuf;
    char **pout = &outbuf;
    memset(outbuf, 0, outlen);
    if (iconv(cd, pin, &inlen, pout, &outlen) == (size_t)-1) {
        perror("iconv");
        iconv_close(cd);
        return false;
    }
    iconv_close(cd);
    return true;
}
```

#### 示例：GBK 转 UTF-8

```cpp
const char* gbk_str = "中文字符串";
char utf8_buf[1024];
if (code_convert("GBK", "UTF-8", gbk_str, strlen(gbk_str), utf8_buf, sizeof(utf8_buf))) {
    std::cout << utf8_buf << std::endl;
}
```

#### 常见编码名（iconv参数）  
- "UTF-8"
- "UTF-16LE" / "UTF-16BE"
- "GBK"
- "GB2312"
- "ISO-8859-1"
- "BIG5"

---

## 4. 注意事项

- **内存预留**：目标缓冲区建议大于源缓冲区（UTF-8 转 GBK 时尤为如此）。
- **中文字符编码**：iconv 参数需与实际编码一致，否则会乱码。
- **异常处理**：建议对 iconv 的返回值进行判断，避免数据丢失。
- **Windows 下**：建议用 [iconv for Windows](https://github.com/win-iconv/win-iconv) 或 ICU 库。

---

## 5. 参考资料

- [Unicode 简明教程](https://www.ruanyifeng.com/blog/2004/12/unicode.html)
- [iconv 官方文档
